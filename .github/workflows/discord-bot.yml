name: discord-bot

defaults:
  run:
    working-directory: ./discord-bot

on:
  push:
    branches: [ master ]
    paths-ignore:
      - 'ui/**'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
  # FIXME: change pipeline to Gradle compilation and Java Docker image
  #   - name: Cache node modules
  #     uses: actions/cache@v1
  #     env:
  #       cache-name: cache-node-modules
  #     with:
  #       path: ~/.npm # npm cache files are stored in `~/.npm` on Linux/macOS
  #       key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/package-lock.json') }}
  #       restore-keys: |
  #         ${{ runner.os }}-build-${{ env.cache-name }}-
  #         ${{ runner.os }}-build-
  #         ${{ runner.os }}-
  #   - name: Install Dependencies
  #     run: npm install
  #   - name: Compile sources
  #     run: npm run build
  #   - uses: docker/build-push-action@v1
  #     with:
  #       path: ./discord-bot
  #       username: ${{ github.actor }}
  #       password: ${{ github.token }}
  #       registry: docker.pkg.github.com
  #       repository: archangelx360/dadigel-sounds/bot-api
  #       tag_with_ref: true
  #       tag_with_sha: true
  # deploy:
  #   needs: build
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Deploying on ${{ secrets.HOST }}
  #       uses: appleboy/ssh-action@master
  #       with:
  #         host: ${{ secrets.HOST }}
  #         username: ${{ secrets.USERNAME }}
  #         password: ${{ secrets.PASSWORD }}
  #         port: ${{ secrets.PORT }}
  #         script_stop: true
  #         script: |
  #           docker stop dadigel-sounds-bot || true
  #           docker rm dadigel-sounds-bot || true
  #           docker login -u ${{ github.actor }} -p ${{ github.token }} docker.pkg.github.com
  #           docker pull docker.pkg.github.com/archangelx360/dadigel-sounds/bot-api:latest
  #           docker run -d -v /opt/dadigel-sounds:/opt -p 8092:8092 --name=dadigel-sounds-bot docker.pkg.github.com/archangelx360/dadigel-sounds/bot-api:latest
